<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Equipment Monitoring</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .tabs { display: flex; margin-bottom: 15px; }
    .tab { padding: 10px 20px; border: 1px solid #ccc; cursor: pointer; }
    .tab.active { background: #007bff; color: white; }
    .content { display: none; border: 1px solid #ccc; padding: 20px; }
    .content.active { display: block; }
    .file-block { margin-bottom: 15px; }
    .status { margin-left: 10px; font-size: 0.9em; }
    progress { width: 200px; }
  </style>
</head>
<body>
  <h2>üìä Equipment Monitoring System</h2>

  <!-- Tab Menu -->
  <div class="tabs">
    <div class="tab active" onclick="showTab(1)">Menu 1: Upload</div>
    <div class="tab" onclick="showTab(2)">Menu 2: Perhitungan</div>
    <div class="tab" onclick="showTab(3)">Menu 3</div>
    <div class="tab" onclick="showTab(4)">Menu 4</div>
  </div>

  <!-- Konten Menu 1 -->
  <div id="content1" class="content active">
    <h3>Upload File Excel</h3>
    <div id="upload-area"></div>
  </div>

  <!-- Konten Menu 2 -->
  <div id="content2" class="content">
    <h3>Perhitungan Data</h3>
    <button onclick="loadData()">üîÑ Hitung dari Data1.xlsx</button>
    <pre id="calc-result">Belum ada data...</pre>
  </div>

  <!-- Konten Menu 3 -->
  <div id="content3" class="content">
    <h3>Menu 3</h3>
    <p>Konten menu 3.</p>
  </div>

  <!-- Konten Menu 4 -->
  <div id="content4" class="content">
    <h3>Menu 4</h3>
    <p>Konten menu 4.</p>
  </div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
/* === Tab Menu === */
function showTab(n) {
  document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active', i===n-1));
  document.querySelectorAll('.content').forEach((c,i)=>c.classList.toggle('active', i===n-1));
}

/* === List File Excel === */
const files = [
  "IW39.xlsx",
  "SUM57.xlsx",
  "DET.xlsx",
  "External Job.xlsx",
  "Planning.xlsx",
  "Equipt Adm.xlsx",
  "Data1.xlsx",
  "Data2.xlsx"
];

/* === Render Upload Form === */
const uploadArea = document.getElementById("upload-area");
files.forEach(name => {
  const safe = name.replace(/\s+/g,'_'); // ganti spasi jadi _
  uploadArea.innerHTML += `
    <div class="file-block">
      <label>${name}:</label>
      <input type="file" id="file-${safe}">
      <button onclick="uploadFile('${safe}')">Upload</button>
      <span id="status-${safe}" class="status"></span><br>
      <progress id="progress-${safe}" value="0" max="100"></progress>
    </div>
  `;
});

/* === Upload ke GitHub === */
async function uploadFile(targetName) {
  const input = document.getElementById(file-${targetName});
  const status = document.getElementById(status-${targetName});
  const progress = document.getElementById(progress-${targetName});

  if (!input.files.length) {
    status.textContent = "‚ö† Pilih file dulu!";
    return;
  }

  const file = input.files[0];
  const content = await file.arrayBuffer();
  const base64 = btoa(String.fromCharCode(...new Uint8Array(content)));

  status.textContent = "‚è≥ Uploading...";
  progress.value = 50;

  try {
    const repo = "USERNAME/REPO"; // ganti dg repo kamu
    const path = data/${file.name};
    const url = https://api.github.com/repos/${repo}/contents/${path};

    const res = await fetch(url, {
      method: "PUT",
      headers: {
        "Authorization": token YOUR_TOKEN_HERE, // ‚ö† nanti diganti otomatis via yml
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: Upload ${file.name},
        content: base64
      })
    });

    if (res.ok) {
      status.textContent = "‚úÖ Sukses upload!";
      progress.value = 100;
    } else {
      status.textContent = "‚ùå Gagal upload!";
      console.error(await res.text());
    }
  } catch (err) {
    status.textContent = "‚ö† Error!";
    console.error(err);
  }
}

/* === Menu 2: Contoh Perhitungan dari Data1.xlsx === */
async function loadData() {
  try {
    const url = "https://raw.githubusercontent.com/USERNAME/REPO/main/data/Data1.xlsx";
    const res = await fetch(url);
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf, { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(sheet);

    let total = 0, count = 0;
    data.forEach(row => {
      if (row.Value) { total += row.Value; count++; }
    });
    const avg = (count>0 ? total/count : 0).toFixed(2);

    document.getElementById("calc-result").textContent =
      Jumlah data: ${count}\nTotal: ${total}\nRata-rata: ${avg};
  } catch (err) {
    document.getElementById("calc-result").textContent = "‚ùå Error baca Data1.xlsx";
    console.error(err);
  }
}
</script>
</body>
</html>
