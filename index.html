<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>WORK_ORDER_EM - Multi Menu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial; font-size: 12px; margin: 12px; }
        .tabs { display:flex; gap:8px; margin-bottom:12px; }
        .tab { padding:8px 14px; background:#e9f0ff; border-radius:6px; cursor:pointer; user-select:none; }
        .tab.active { background:#2f80ed; color:white; font-weight:600; }
        .panel { display:none; }
        .panel.active { display:block; }
        .filter-container { margin-bottom: 12px; padding: 10px; background-color: #f7f7f7; border-radius: 6px; }
        .filter-container label { margin-right: 8px; font-size: 13px; }
        table { border-collapse: collapse; width: 100%; margin-top: 8px; }
        th, td { border: 1px solid #ccc; padding: 6px; }
        th { background-color: #eee; cursor: pointer; user-select: none; position: relative; }
        th.sort-asc::after { content: " ▲"; font-size: 10px; color: #333; }
        th.sort-desc::after { content: " ▼"; font-size: 10px; color: #333; }
        tbody tr:nth-child(odd) { background: #fbfdff; }
        tbody tr:hover { background: #eef6ff; }
        .small { font-size:11px; color:#333; }
        .controls { margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
        .btn { padding:6px 10px; border-radius:4px; border:1px solid #ccc; background:white; cursor:pointer; }
    </style>
</head>
<body>
    <h2>WORK_ORDER_EM</h2>

    <div class="tabs">
        <div class="tab active" id="tab-work">Work Order</div>
        <div class="tab" id="tab-detail">Detail Part</div>
        <div class="tab" id="tab-ext">External Job</div>
    </div>

    <!-- PANEL: Work Order (Menu 1) -->
    <div class="panel active" id="panel-work">
        <div class="filter-container">
            <label>Room: <input type="text" id="w-filter-room"></label>
            <label>Order: <input type="text" id="w-filter-order"></label>
            <label>MAT: <input type="text" id="w-filter-mat"></label>
            <label>Section: <input type="text" id="w-filter-section"></label>
            <label>CPH: <input type="text" id="w-filter-cph"></label>
            <label>Status: <input type="text" id="w-filter-status"></label>
            <div class="controls">
                <input type="file" id="w-upload" accept=".xlsx" />
                <button class="btn" id="w-clear">Clear filters</button>
            </div>
        </div>
        <table id="w-table" class="small"></table>
    </div>

    <!-- PANEL: Detail Part (Menu 2) -->
    <div class="panel" id="panel-detail">
        <div class="filter-container">
            <label>Order: <input type="text" id="d-filter-order"></label>
            <label>Material Number: <input type="text" id="d-filter-matnum"></label>
            <label>Material Description: <input type="text" id="d-filter-matdesc"></label>
            <div class="controls">
                <input type="file" id="d-upload" accept=".xlsx" />
                <button class="btn" id="d-clear">Clear filters</button>
            </div>
        </div>
        <table id="d-table" class="small"></table>
    </div>

    <!-- PANEL: External Job (Menu 3) -->
    <div class="panel" id="panel-ext">
        <div class="filter-container">
            <label>Room: <input type="text" id="e-filter-room"></label>
            <label>Order: <input type="text" id="e-filter-order"></label>
            <label>Activity: <input type="text" id="e-filter-activity"></label>
            <label>Description: <input type="text" id="e-filter-desc"></label>
            <label>Purchase Doc: <input type="text" id="e-filter-podoc"></label>
            <label>Purchase Req: <input type="text" id="e-filter-prnum"></label>
            <div class="controls">
                <input type="file" id="e-upload" accept=".xlsx" />
                <button class="btn" id="e-clear">Clear filters</button>
            </div>
        </div>
        <table id="e-table" class="small"></table>
    </div>

    <script>
    /*********************
     * HELPERS
     *********************/
    function debounce(fn, wait) { let t; return function(...args) { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), wait); }; }
    function getIndex(headers, keyword) { keyword = (keyword || '').toLowerCase(); return headers.findIndex(h => (h || '').toLowerCase().includes(keyword)); }
    function buildTableFromJson(tableEl, headers, rows) {
        tableEl.innerHTML = "";
        const thead = document.createElement('thead');
        const tr = document.createElement('tr');
        headers.forEach((h, idx) => { const th = document.createElement('th'); th.textContent = h; tr.appendChild(th); });
        thead.appendChild(tr); tableEl.appendChild(thead);
        const tbody = document.createElement('tbody');
        rows.forEach(rowArr => { const row = document.createElement('tr'); headers.forEach((h,i)=>{ const td=document.createElement('td'); td.textContent=rowArr[i]||""; row.appendChild(td); }); tbody.appendChild(row); });
        tableEl.appendChild(tbody);
    }

    /*********************
     * Tabs
     *********************/
    const tabWork=document.getElementById('tab-work'), tabDetail=document.getElementById('tab-detail'), tabExt=document.getElementById('tab-ext');
    const panelWork=document.getElementById('panel-work'), panelDetail=document.getElementById('panel-detail'), panelExt=document.getElementById('panel-ext');
    function showMenu(id){ [tabWork,tabDetail,tabExt].forEach(t=>t.classList.remove('active')); [panelWork,panelDetail,panelExt].forEach(p=>p.classList.remove('active'));
      if(id==='work'){tabWork.classList.add('active');panelWork.classList.add('active');}
      else if(id==='detail'){tabDetail.classList.add('active');panelDetail.classList.add('active');}
      else{tabExt.classList.add('active');panelExt.classList.add('active');}
    }
    tabWork.addEventListener('click',()=>showMenu('work'));
    tabDetail.addEventListener('click',()=>showMenu('detail'));
    tabExt.addEventListener('click',()=>showMenu('ext'));

    /*********************
     * Menu 1 - Work Order
     *********************/
    let wHeaders=[]; const wTable=document.getElementById('w-table');
    document.getElementById('w-upload').addEventListener('change', function(e){
        const f=e.target.files[0]; if(!f)return; const reader=new FileReader();
        reader.onload=function(ev){ const data=new Uint8Array(ev.target.result); const wb=XLSX.read(data,{type:'array'});
            const sheet=wb.Sheets[wb.SheetNames[0]]; const json=XLSX.utils.sheet_to_json(sheet,{header:1,raw:true});
            if(!json.length){alert("No data");return;} wHeaders=json[0]; const rows=json.slice(1);
            buildTableFromJson(wTable,wHeaders,rows); applyWorkFilters(); };
        reader.readAsArrayBuffer(f);
    });
    function applyWorkFilters(){ /* ... sama kayak sebelumnya ... */ }
    const debouncedApplyWorkFilters=debounce(applyWorkFilters,120);
    document.querySelectorAll("#panel-work .filter-container input[type=text]").forEach(inp=>inp.addEventListener('input',debouncedApplyWorkFilters));
    document.getElementById('w-clear').addEventListener('click',()=>{document.querySelectorAll("#panel-work .filter-container input[type=text]").forEach(i=>i.value='');applyWorkFilters();});

    /*********************
     * Menu 2 - Detail Part
     *********************/
    let dHeaders=[]; const dTable=document.getElementById('d-table');
    document.getElementById('d-upload').addEventListener('change', function(e){
        const f=e.target.files[0]; if(!f)return; const reader=new FileReader();
        reader.onload=function(ev){ const data=new Uint8Array(ev.target.result); const wb=XLSX.read(data,{type:'array'});
            const sheet=wb.Sheets[wb.SheetNames[0]]; const json=XLSX.utils.sheet_to_json(sheet,{header:1,raw:true});
            if(!json.length){alert("No data");return;} dHeaders=json[0]; const rows=json.slice(1);
            buildTableFromJson(dTable,dHeaders,rows); applyDetailFilters(); };
        reader.readAsArrayBuffer(f);
    });
    function applyDetailFilters(){ /* ... sama kayak sebelumnya ... */ }
    const debouncedApplyDetailFilters=debounce(applyDetailFilters,120);
    document.querySelectorAll("#panel-detail .filter-container input[type=text]").forEach(inp=>inp.addEventListener('input',debouncedApplyDetailFilters));
    document.getElementById('d-clear').addEventListener('click',()=>{document.querySelectorAll("#panel-detail .filter-container input[type=text]").forEach(i=>i.value='');applyDetailFilters();});

    /*********************
     * Menu 3 - External Job
     *********************/
    const eTable=document.getElementById('e-table'); let eHeaders=[],eRows=[];
    const extCols=["Room","Manufacturer model number","Order Number","Maintenance activity type","Field displaying user status","Description","Aging WO","Net Price in PO USD","Cost Element","Service number","Service Short Text","Name","Purchase Requisition Number","Purchasing Document Number","Entry Sheet Number"];
    document.getElementById('e-upload').addEventListener('change',function(e){const f=e.target.files[0];if(!f)return;const reader=new FileReader();
      reader.onload=function(ev){const data=new Uint8Array(ev.target.result);const wb=XLSX.read(data,{type:'array'});const sheet=wb.Sheets[wb.SheetNames[0]];const json=XLSX.utils.sheet_to_json(sheet,{header:1,raw:true});
        if(!json.length){alert("No data");return;} const allHeaders=json[0].map(h=>h?String(h).trim():"");
        eHeaders=extCols.filter(c=>allHeaders.includes(c));
        eRows=json.slice(1).map(row=>eHeaders.map(h=>{const idx=allHeaders.indexOf(h);return idx>=0?row[idx]:"";}));
        buildTableFromJson(eTable,eHeaders,eRows); applyExtFilters();}; reader.readAsArrayBuffer(f);});
    function getIndexExt(name){return eHeaders.findIndex(h=>h.toLowerCase()===name.toLowerCase());}
    function applyExtFilters(){ if(!eTable.tBodies[0])return; const rows=Array.from(eTable.tBodies[0].rows);
      const fRoom=document.getElementById('e-filter-room').value.toLowerCase();
      const fOrder=document.getElementById('e-filter-order').value.toLowerCase();
      const fAct=document.getElementById('e-filter-activity').value.toLowerCase();
      const fDesc=document.getElementById('e-filter-desc').value.toLowerCase();
      const fPODoc=document.getElementById('e-filter-podoc').value.toLowerCase();
      const fPRNum=document.getElementById('e-filter-prnum').value.toLowerCase();
      const idxRoom=getIndexExt("Room"), idxOrder=getIndexExt("Order Number"), idxAct=getIndexExt("Maintenance activity type"),
            idxDesc=getIndexExt("Description"), idxPODoc=getIndexExt("Purchasing Document Number"), idxPRNum=getIndexExt("Purchase Requisition Number");
      rows.forEach(row=>{let show=true;
        if(fRoom&&idxRoom>=0&&!row.cells[idxRoom].textContent.toLowerCase().includes(fRoom))show=false;
        if(show&&fOrder&&idxOrder>=0&&!row.cells[idxOrder].textContent.toLowerCase().includes(fOrder))show=false;
        if(show&&fAct&&idxAct>=0&&!row.cells[idxAct].textContent.toLowerCase().includes(fAct))show=false;
        if(show&&fDesc&&idxDesc>=0&&!row.cells[idxDesc].textContent.toLowerCase().includes(fDesc))show=false;
        if(show&&fPODoc&&idxPODoc>=0&&!row.cells[idxPODoc].textContent.toLowerCase().includes(fPODoc))show=false;
        if(show&&fPRNum&&idxPRNum>=0&&!row.cells[idxPRNum].textContent.toLowerCase().includes(fPRNum))show=false;
        row.style.display=show?"":"none";});
    }
    const debouncedApplyExtFilters=debounce(applyExtFilters,150);
    document.querySelectorAll("#panel-ext .filter-container input[type=text]").forEach(inp=>inp.addEventListener('input',debouncedApplyExtFilters));
    document.getElementById('e-clear').addEventListener('click',()=>{document.querySelectorAll("#panel-ext .filter-container input[type=text]").forEach(i=>i.value='');applyExtFilters();});
    </script>
</body>
</html>
