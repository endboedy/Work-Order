<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<title>WORK_ORDER_EM - Multi Menu</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body { font-family: Arial; font-size: 12px; margin: 12px; }
.tabs { display:flex; gap:8px; margin-bottom:12px; }
.tab { padding:8px 14px; background:#e9f0ff; border-radius:6px; cursor:pointer; user-select:none; }
.tab.active { background:#2f80ed; color:white; font-weight:600; }
.panel { display:none; }
.panel.active { display:block; }
.filter-container { margin-bottom: 12px; padding: 10px; background-color: #f7f7f7; border-radius: 6px; }
.filter-container label { margin-right: 8px; font-size: 13px; }
table { border-collapse: collapse; width: 100%; margin-top: 8px; }
th, td { border: 1px solid #ccc; padding: 6px; }
th { background-color: #eee; cursor: pointer; user-select: none; position: relative; }
th.sort-asc::after { content: " ▲"; font-size: 10px; color: #333; }
th.sort-desc::after { content: " ▼"; font-size: 10px; color: #333; }
tbody tr:nth-child(odd) { background: #fbfdff; }
tbody tr:hover { background: #eef6ff; }
.small { font-size:11px; color:#333; }
.controls { margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.btn { padding:6px 10px; border-radius:4px; border:1px solid #ccc; background:white; cursor:pointer; }
</style>
</head>
<body>
<h2>WORK_ORDER_EM</h2>
<div class="tabs">
<div class="tab active" id="tab-work">Work Order</div>
<div class="tab" id="tab-detail">Detail Part</div>
<div class="tab" id="tab-ext">External Job</div>
<div class="tab" id="tab-monthly">List WO Monthly</div>
<div class="tab" id="tab-inspect">I-Inspect</div>
</div>
<!-- PANEL 1: Work Order -->
<div class="panel active" id="panel-work">
<div class="filter-container">
<label>Room: <input id="w-filter-room" placeholder="filter Room" type="text"/></label>
<label>Order: <input id="w-filter-order" placeholder="filter Order" type="text"/></label>
<label>MAT: <input id="w-filter-mat" placeholder="filter MAT" type="text"/></label>
<label>Section: <input id="w-filter-section" placeholder="filter Section" type="text"/></label>
<label>CPH: <input id="w-filter-cph" placeholder="filter CPH" type="text"/></label>
<label>Status: <input id="w-filter-status" placeholder="filter Status" type="text"/></label>
<div class="controls">
<input accept=".xlsx" id="w-upload" type="file">
<button class="btn" id="w-clear">Clear filters</button>
</input></div>
</div>
<table class="small" id="w-table"></table>
</div>
<!-- PANEL 2: Detail Part -->
<div class="panel" id="panel-detail">
<div class="filter-container">
<label>Order: <input id="d-filter-order" placeholder="filter Order" type="text"/></label>
<label>Material Number: <input id="d-filter-matnum" placeholder="filter Material Number" type="text"/></label>
<label>Material Description: <input id="d-filter-matdesc" placeholder="filter Material Description" type="text"/></label>
<div class="controls">
<input accept=".xlsx" id="d-upload" type="file">
<button class="btn" id="d-clear">Clear filters</button>
</input></div>
</div>
<table class="small" id="d-table"></table>
</div>
<!-- PANEL 3: External Job -->
<div class="panel" id="panel-ext">
<div class="filter-container">
<label>Room: <input id="e-filter-room" placeholder="filter Room" type="text"/></label>
<label>Order: <input id="e-filter-order" placeholder="filter Order" type="text"/></label>
<label>Activity: <input id="e-filter-activity" placeholder="filter Activity" type="text"/></label>
<label>Description: <input id="e-filter-desc" placeholder="filter Description" type="text"/></label>
<div class="controls">
<input accept=".xlsx" id="e-upload" type="file">
<button class="btn" id="e-clear">Clear filters</button>
</input></div>
</div>
<table class="small" id="e-table"></table>
</div>
<!-- PANEL 4: List WO Monthly -->
<div class="panel" id="panel-monthly">
<div class="filter-container">
<label>Month: <input id="m-filter-month" placeholder="filter Month" type="text"/></label>
<label>Room: <input id="m-filter-room" placeholder="filter Room" type="text"/></label>
<label>User Status: <input id="m-filter-statususer" placeholder="filter User Status" type="text"/></label>
<label>MAT: <input id="m-filter-mat" placeholder="filter MAT" type="text"/></label>
<label>CPH: <input id="m-filter-cph" placeholder="filter CPH" type="text"/></label>
<label>Section: <input id="m-filter-section" placeholder="filter Section" type="text"/></label>
<label>Status AMT: <input id="m-filter-statusamt" placeholder="filter Status AMT" type="text"/></label>
<div class="controls">
<button class="btn" id="m-clear">Clear filters</button>
</div>
</div>
<table class="small" id="m-table"></table>
</div>
<script>

// ----------------- Helpers -----------------
function formatDateFromSerialOrDate(v){if(v===null||v===undefined||v==='')return"";const o={day:'2-digit',month:'short',year:'numeric'};if(v instanceof Date)return v.toLocaleDateString('en-US',o).replace(/ /g,'-');if(typeof v==='number')return new Date(Math.round((v-25569)*86400*1000)).toLocaleDateString('en-US',o).replace(/ /g,'-');const p=Date.parse(String(v));if(!isNaN(p))return new Date(p).toLocaleDateString('en-US',o).replace(/ /g,'-');return String(v);}
function formatCurrency(v){if(v===null||v===undefined||v==='')return"";const n=Number(String(v).replace(/[^0-9.-]/g,''));return !isNaN(n)?("$"+Math.round(n).toLocaleString()):String(v);}
function applyStyleToTd(td,col,val){if(!td)return;const c=String(col||'').toLowerCase();const v=(val===null||val===undefined)?'':String(val).trim();if(["order","created on","planning","target date","end date","cost","include","exclude"].includes(c))td.style.textAlign="right";else if(["user status","mat"].includes(c))td.style.textAlign="center";else td.style.textAlign="left";if(c==="status part"){if(v==="Complete"){td.style.backgroundColor="green";td.style.color="white";}else if(v==="Not Complete"){td.style.backgroundColor="red";td.style.color="white";}}else if(c==="aging"){const a=parseInt(v);if(!isNaN(a)){td.style.backgroundColor=(a<=30)?"green":"red";td.style.color="white";}}else if(c==="status amt"){if(v==="O"){td.style.backgroundColor="lightgray";td.style.color="black";}else if(v==="YTS"){td.style.backgroundColor="green";td.style.color="white";}else if(v==="IP"){td.style.backgroundColor="orange";td.style.color="red";}else if(v==="C"){td.style.backgroundColor="black";td.style.color="white";}}}
function parseValueForSort(t){const s=(t===null||t===undefined)?'':String(t).trim();if(s==='')return'';const n=Number(s.replace(/[^0-9.\-]/g,''));if(!isNaN(n)&&/[0-9]/.test(s))return n;const p=Date.parse(s);if(!isNaN(p))return p;return s.toLowerCase();}
function clearSortIndicators(t){if(!t)return;t.querySelectorAll('th').forEach(th=>{th.classList.remove('sort-asc','sort-desc');delete th.dataset.sorted;});}
function debounce(fn,wait){let t;return function(...a){clearTimeout(t);t=setTimeout(()=>fn.apply(this,a),wait);};}
function getIndex(headers,keyword){keyword=(keyword||'').toLowerCase();return headers.findIndex(h=>(h||'').toLowerCase().includes(keyword));}

// ----------------- Tab Switch -----------------
const tabs=document.querySelectorAll('.tab');const panels=document.querySelectorAll('.panel');
tabs.forEach(tab=>{tab.addEventListener('click',()=>{tabs.forEach(t=>t.classList.remove('active'));tab.classList.add('active');panels.forEach(p=>p.classList.remove('active'));const pid='panel-'+tab.id.split('-')[1];document.getElementById(pid).classList.add('active');});});

// ----------------- Build Table -----------------
function buildTableFromJson(tableEl,headers,rows){
    while(tableEl.firstChild)tableEl.removeChild(tableEl.firstChild);
    const thead=document.createElement('thead'); const tr=document.createElement('tr');
    headers.forEach((h,i)=>{const th=document.createElement('th'); th.textContent=h; th.dataset.colIndex=i; th.addEventListener('click',()=>sortTableByIndex(tableEl,i,th)); tr.appendChild(th);});
    thead.appendChild(tr); tableEl.appendChild(thead);
    const tbody=document.createElement('tbody'); const frag=document.createDocumentFragment();
    rows.forEach(r=>{const row=document.createElement('tr');for(let i=0;i<headers.length;i++){const col=headers[i]||'';let raw=(r&&r[i]!==undefined&&r[i]!==null)?r[i]:'';let txt='';const lc=col.toLowerCase(); if(["created on","planning","target date","end date"].includes(lc)) txt=formatDateFromSerialOrDate(raw);else if(["cost","include","exclude"].includes(lc)) txt=formatCurrency(raw);else{if(raw instanceof Date) txt=formatDateFromSerialOrDate(raw); else txt=String(raw);} const td=document.createElement('td'); td.textContent=txt; applyStyleToTd(td,col,txt); row.appendChild(td);}frag.appendChild(row);});
    tbody.appendChild(frag); tableEl.appendChild(tbody);
}
function sortTableByIndex(tableEl,colIndex,thElement){if(!tableEl||!tableEl.tBodies[0])return;const tbody=tableEl.tBodies[0];const asc=thElement.dataset.sorted!=='asc';clearSortIndicators(tableEl);thElement.dataset.sorted=asc?'asc':'desc';thElement.classList.add(asc?'sort-asc':'sort-desc');const rows=Array.from(tbody.rows);rows.sort((a,b)=>{const aText=(a.cells[colIndex]&&a.cells[colIndex].textContent)?a.cells[colIndex].textContent:'';const bText=(b.cells[colIndex]&&b.cells[colIndex].textContent)?b.cells[colIndex].textContent:'';const va=parseValueForSort(aText); const vb=parseValueForSort(bText);if(typeof va==='number'&&typeof vb==='number')return asc?(va-vb):(vb-va);if(typeof va==='number')return asc?-1:1;if(typeof vb==='number')return asc?1:-1;return asc?String(va).localeCompare(String(vb)):String(vb).localeCompare(String(va));});rows.forEach(r=>tbody.appendChild(r));}


// ----------------- Menu 1: Work Order -----------------
let wHeaders=[]; const wTable=document.getElementById('w-table');
document.getElementById('w-upload').addEventListener('change',function(e){
    const f=e.target.files[0]; if(!f) return;
    const reader=new FileReader();
    reader.onload=function(ev){
        const data=new Uint8Array(ev.target.result);
        const wb=XLSX.read(data,{type:'array'});
        const sheet=wb.Sheets[wb.SheetNames[0]];
        const json=XLSX.utils.sheet_to_json(sheet,{header:1,raw:true});
        if(!json||json.length===0){alert('No data');return;}
        wHeaders=json[0].map(h=>h===null||h===undefined?'':String(h).trim());
        const rows=json.slice(1); buildTableFromJson(wTable,wHeaders,rows); applyWorkFilters();
    };
    reader.readAsArrayBuffer(f);
});
function applyWorkFilters(){
    const fRoom=(document.getElementById('w-filter-room').value||'').toLowerCase();
    const fOrder=(document.getElementById('w-filter-order').value||'').toLowerCase();
    const fMat=(document.getElementById('w-filter-mat').value||'').toLowerCase();
    const fSection=(document.getElementById('w-filter-section').value||'').toLowerCase();
    const fCph=(document.getElementById('w-filter-cph').value||'').toLowerCase();
    const fStatus=(document.getElementById('w-filter-status').value||'').toLowerCase();
    if(!wTable.tBodies[0]) return; const rows=Array.from(wTable.tBodies[0].rows);
    const idxRoom=getIndex(wHeaders,'room'); const idxOrder=getIndex(wHeaders,'order'); const idxMat=getIndex(wHeaders,'mat'); const idxSection=getIndex(wHeaders,'section'); const idxCph=getIndex(wHeaders,'cph'); const idxStatus=getIndex(wHeaders,'status');
    rows.forEach(row=>{
        let show=true;
        if(fRoom&&idxRoom>=0 && !(row.cells[idxRoom]?.textContent.toLowerCase()||'').includes(fRoom)) show=false;
        if(show&&fOrder&&idxOrder>=0 && !(row.cells[idxOrder]?.textContent.toLowerCase()||'').includes(fOrder)) show=false;
        if(show&&fMat&&idxMat>=0 && !(row.cells[idxMat]?.textContent.toLowerCase()||'').includes(fMat)) show=false;
        if(show&&fSection&&idxSection>=0 && !(row.cells[idxSection]?.textContent.toLowerCase()||'').includes(fSection)) show=false;
        if(show&&fCph&&idxCph>=0 && !(row.cells[idxCph]?.textContent.toLowerCase()||'').includes(fCph)) show=false;
        if(show&&fStatus&&idxStatus>=0 && !(row.cells[idxStatus]?.textContent.toLowerCase()||'').includes(fStatus)) show=false;
        row.style.display=show?'':'none';
    });
}
document.querySelectorAll("#panel-work .filter-container input[type=text]").forEach(inp=>inp.addEventListener('input',debounce(applyWorkFilters,120)));
document.getElementById('w-clear').addEventListener('click',()=>{
    document.querySelectorAll("#panel-work .filter-container input[type=text]").forEach(i=>i.value=''); applyWorkFilters();
});

// ----------------- Menu 2: Detail Part -----------------
let dHeaders=[]; const dTable=document.getElementById('d-table');
document.getElementById('d-upload').addEventListener('change',function(e){
    const f=e.target.files[0]; if(!f) return;
    const reader=new FileReader();
    reader.onload=function(ev){
        const data=new Uint8Array(ev.target.result);
        const wb=XLSX.read(data,{type:'array'});
        const sheet=wb.Sheets[wb.SheetNames[0]];
        const json=XLSX.utils.sheet_to_json(sheet,{header:1,raw:true});
        if(!json||json.length===0){alert('No data');return;}
        dHeaders=json[0].map(h=>h===null||h===undefined?'':String(h).trim());
        const rows=json.slice(1); buildTableFromJson(dTable,dHeaders,rows); applyDetailFilters();
    };
    reader.readAsArrayBuffer(f);
});
function applyDetailFilters(){
    const fOrder=(document.getElementById('d-filter-order').value||'').toLowerCase();
    const fMatNum=(document.getElementById('d-filter-matnum').value||'').toLowerCase();
    const fMatDesc=(document.getElementById('d-filter-matdesc').value||'').toLowerCase();
    if(!dTable.tBodies[0]) return; const rows=Array.from(dTable.tBodies[0].rows);
    const idxOrder=getIndex(dHeaders,'order');
    const idxMatNum=getIndex(dHeaders,'material')!==-1?getIndex(dHeaders,'material'):getIndex(dHeaders,'material number');
    const idxMatDesc=getIndex(dHeaders,'description')!==-1?getIndex(dHeaders,'description'):getIndex(dHeaders,'material description');
    rows.forEach(row=>{
        let show=true;
        if(fOrder){if(idxOrder>=0){const txt=row.cells[idxOrder]?.textContent.toLowerCase()||''; if(!txt.includes(fOrder)) show=false;}else{if(!row.textContent.toLowerCase().includes(fOrder)) show=false;}}
        if(show&&fMatNum){if(idxMatNum>=0){const txt=row.cells[idxMatNum]?.textContent.toLowerCase()||''; if(!txt.includes(fMatNum)) show=false;}else{if(!row.textContent.toLowerCase().includes(fMatNum)) show=false;}}
        if(show&&fMatDesc){if(idxMatDesc>=0){const txt=row.cells[idxMatDesc]?.textContent.toLowerCase()||''; if(!txt.includes(fMatDesc)) show=false;}else{if(!row.textContent.toLowerCase().includes(fMatDesc)) show=false;}}
        row.style.display=show?'':'none';
    });
}
document.querySelectorAll("#panel-detail .filter-container input[type=text]").forEach(inp=>inp.addEventListener('input',debounce(applyDetailFilters,120)));
document.getElementById('d-clear').addEventListener('click',()=>{document.querySelectorAll("#panel-detail .filter-container input[type=text]").forEach(i=>i.value=''); applyDetailFilters();});

// ----------------- Menu 3: External Job -----------------
let eHeaders=[]; const eTable=document.getElementById('e-table');
const allowedCols=["Room","Manufacturer model number","Order Number","Maintenance activity type","Field displaying user status","Description","Aging WO","Net Price in PO USD","Cost Element","Service number","Service Short Text","Name","Purchase Requisition Number","Purchasing Document Number","Entry Sheet Number"];
document.getElementById('e-upload').addEventListener('change',function(e){
    const f=e.target.files[0]; if(!f) return;
    const reader=new FileReader();
    reader.onload=function(ev){
        const data=new Uint8Array(ev.target.result);
        const wb=XLSX.read(data,{type:'array'});
        const sheet=wb.Sheets[wb.SheetNames[0]];
        const json=XLSX.utils.sheet_to_json(sheet,{header:1,raw:true});
        if(!json||json.length===0){alert('No data');return;}
        const rawHeaders=json[0].map(h=>h===null||h===undefined?'':String(h).trim());
        eHeaders=rawHeaders.filter(h=>allowedCols.includes(h));
        const rows=json.slice(1).map(r=>eHeaders.map(h=>{const idx=rawHeaders.indexOf(h); return idx>=0?r[idx]:"";}));
        buildTableFromJson(eTable,eHeaders,rows); applyExtFilters();
    };
    reader.readAsArrayBuffer(f);
});
function applyExtFilters(){
    const fRoom=(document.getElementById('e-filter-room').value||'').toLowerCase();
    const fOrder=(document.getElementById('e-filter-order').value||'').toLowerCase();
    const fAct=(document.getElementById('e-filter-activity').value||'').toLowerCase();
    const fDesc=(document.getElementById('e-filter-desc').value||'').toLowerCase();
    if(!eTable.tBodies[0]) return; const rows=Array.from(eTable.tBodies[0].rows);
    const idxRoom=eHeaders.indexOf("Room"); const idxOrder=eHeaders.indexOf("Order Number"); const idxAct=eHeaders.indexOf("Maintenance activity type"); const idxDesc=eHeaders.indexOf("Description");
    rows.forEach(row=>{
        let show=true;
        if(fRoom&&idxRoom>=0 && !(row.cells[idxRoom]?.textContent.toLowerCase()||'').includes(fRoom)) show=false;
        if(show&&fOrder&&idxOrder>=0 && !(row.cells[idxOrder]?.textContent.toLowerCase()||'').includes(fOrder)) show=false;
        if(show&&fAct&&idxAct>=0 && !(row.cells[idxAct]?.textContent.toLowerCase()||'').includes(fAct)) show=false;
        if(show&&fDesc&&idxDesc>=0 && !(row.cells[idxDesc]?.textContent.toLowerCase()||'').includes(fDesc)) show=false;
        row.style.display=show?'':'none';
    });
}
document.querySelectorAll("#panel-ext .filter-container input[type=text]").forEach(inp=>inp.addEventListener('input',debounce(applyExtFilters,120)));
document.getElementById('e-clear').addEventListener('click',()=>{document.querySelectorAll("#panel-ext .filter-container input[type=text]").forEach(i=>i.value=''); applyExtFilters();});

// ----------------- Menu 4: List WO Monthly -----------------
(function(){
    const mTable=document.getElementById('m-table');
    function buildMonthlyTable(){
        if(!wTable||!wTable.tBodies[0]||!wHeaders)return;
        const fMonth=(document.getElementById('m-filter-month').value||'').toLowerCase();
        const fRoom=(document.getElementById('m-filter-room').value||'').toLowerCase();
        const fUserStatus=(document.getElementById('m-filter-statususer').value||'').toLowerCase();
        const fMat=(document.getElementById('m-filter-mat').value||'').toLowerCase();
        const fCph=(document.getElementById('m-filter-cph').value||'').toLowerCase();
        const fSection=(document.getElementById('m-filter-section').value||'').toLowerCase();
        const fStatusAmt=(document.getElementById('m-filter-statusamt').value||'').toLowerCase();
        const headers=wHeaders.slice();
        const rows=Array.from(wTable.tBodies[0].rows)
            .filter(r=>{
                let show=true;
                const idxMonth=getIndex(headers,'month'); const idxRoom=getIndex(headers,'room');
                const idxUserStatus=getIndex(headers,'user status'); const idxMat=getIndex(headers,'mat');
                const idxCph=getIndex(headers,'cph'); const idxSection=getIndex(headers,'section');
                const idxStatusAmt=getIndex(headers,'status amt');
                if(idxMonth>=0 && fMonth && !(r.cells[idxMonth]?.textContent.toLowerCase()||'').includes(fMonth))show=false;
                if(idxRoom>=0 && fRoom && !(r.cells[idxRoom]?.textContent.toLowerCase()||'').includes(fRoom))show=false;
                if(idxUserStatus>=0 && fUserStatus && !(r.cells[idxUserStatus]?.textContent.toLowerCase()||'').includes(fUserStatus))show=false;
                if(idxMat>=0 && fMat && !(r.cells[idxMat]?.textContent.toLowerCase()||'').includes(fMat))show=false;
                if(idxCph>=0 && fCph && !(r.cells[idxCph]?.textContent.toLowerCase()||'').includes(fCph))show=false;
                if(idxSection>=0 && fSection && !(r.cells[idxSection]?.textContent.toLowerCase()||'').includes(fSection))show=false;
                if(idxStatusAmt>=0 && fStatusAmt && !(r.cells[idxStatusAmt]?.textContent.toLowerCase()||'').includes(fStatusAmt))show=false;
                return show;
            })
            .map(r=>Array.from(r.cells).map(c=>c.textContent));
        buildTableFromJson(mTable,headers,rows);
    }
    document.querySelectorAll("#panel-monthly .filter-container input[type=text]").forEach(inp=>inp.addEventListener('input',debounce(buildMonthlyTable,120)));
    document.getElementById('m-clear').addEventListener('click',()=>{
        document.querySelectorAll("#panel-monthly .filter-container input[type=text]").forEach(i=>i.value='');
        buildMonthlyTable();
    });
})();
</script>
<!-- PANEL 5: I-Inspect -->
<div class="panel" id="panel-inspect">
<div class="filter-container">
<label>PartNumber: <input id="i-filter-partnum" placeholder="filter PartNumber" type="text"/></label>
<label>PartDescription: <input id="i-filter-partdesc" placeholder="filter PartDescription" type="text"/></label>
<label>Notification_Number: <input id="i-filter-notif" placeholder="filter Notification_Number" type="text"/></label>
<label>WO_Part_Number: <input id="i-filter-wopart" placeholder="filter WO_Part_Number" type="text"/></label>
<label>WO_Number: <input id="i-filter-wonum" placeholder="filter WO_Number" type="text"/></label>
<div class="controls">
<input accept=".xlsx" id="i-upload" type="file">
<button class="btn" id="i-clear">Clear filters</button>
</input></div>
</div>
<table class="small" id="i-table"></table>
</div>
<script>
// ----------------- Menu 5: I-Inspect -----------------
let iHeaders = [];
const iTable = document.getElementById('i-table');

document.getElementById('i-upload').addEventListener('change', function(e){
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = function(ev){
        const data = new Uint8Array(ev.target.result);
        const wb = XLSX.read(data, {type:'array'});
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, {header:1, raw:true});
        if(!json || json.length===0){ alert('No data'); return; }
        iHeaders = json[0].map(h => h==null ? '' : String(h).trim());
        const rows = json.slice(1);
        buildTableFromJson(iTable, iHeaders, rows);
        applyInspectFilters();
    };
    reader.readAsArrayBuffer(f);
});

function applyInspectFilters(){
    const fPartNum = (document.getElementById('i-filter-partnum').value||'').toLowerCase();
    const fPartDesc = (document.getElementById('i-filter-partdesc').value||'').toLowerCase();
    const fNotif = (document.getElementById('i-filter-notif').value||'').toLowerCase();
    const fWOPart = (document.getElementById('i-filter-wopart').value||'').toLowerCase();
    const fWONum = (document.getElementById('i-filter-wonum').value||'').toLowerCase();
    if(!iTable.tBodies[0]) return;
    const rows = Array.from(iTable.tBodies[0].rows);

    const idxPartNum = getIndex(iHeaders,'partnumber');
    const idxPartDesc = getIndex(iHeaders,'partdescription');
    const idxNotif = getIndex(iHeaders,'notification_number');
    const idxWOPart = getIndex(iHeaders,'wo_part_number');
    const idxWONum = getIndex(iHeaders,'wo_number');

    rows.forEach(row=>{
        let show = true;
        if(fPartNum && idxPartNum>=0 && !(row.cells[idxPartNum]?.textContent.toLowerCase()||'').includes(fPartNum)) show=false;
        if(show && fPartDesc && idxPartDesc>=0 && !(row.cells[idxPartDesc]?.textContent.toLowerCase()||'').includes(fPartDesc)) show=false;
        if(show && fNotif && idxNotif>=0 && !(row.cells[idxNotif]?.textContent.toLowerCase()||'').includes(fNotif)) show=false;
        if(show && fWOPart && idxWOPart>=0 && !(row.cells[idxWOPart]?.textContent.toLowerCase()||'').includes(fWOPart)) show=false;
        if(show && fWONum && idxWONum>=0 && !(row.cells[idxWONum]?.textContent.toLowerCase()||'').includes(fWONum)) show=false;
        row.style.display = show ? '' : 'none';
    });
}

// Filter input events
document.querySelectorAll("#panel-inspect .filter-container input[type=text]").forEach(inp=>{
    inp.addEventListener('input', debounce(applyInspectFilters, 120));
});

// Clear button
document.getElementById('i-clear').addEventListener('click', ()=>{
    document.querySelectorAll("#panel-inspect .filter-container input[type=text]").forEach(i=>i.value=''); 
    applyInspectFilters();
});
</script>

<div class="modal" id="popupModal" style="display:none; position:fixed; top:10%; left:10%; width:80%; height:80%; background:white; border:1px solid #ccc; overflow:auto; z-index:1000; padding:20px;">
<h3>Detail Part for Selected Order</h3>
<table class="small" id="popupTable" style="width:100%; border-collapse:collapse;"></table>
<button onclick="document.getElementById('popupModal').style.display='none'">Close</button>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const wTable = document.getElementById("w-table");
  const dTable = document.getElementById("d-table");
  const popupTable = document.getElementById("popupTable");
  const popupModal = document.getElementById("popupModal");

  if (wTable) {
    wTable.addEventListener("click", function(e) {
      const cell = e.target;
      const row = cell.parentElement;
      const colIndex = Array.from(row.children).indexOf(cell);
      if (colIndex === 2) { // kolom ke-3 (index 2)
        const orderNumber = cell.innerText.trim();
        const dRows = dTable.querySelectorAll("tbody tr");
        popupTable.innerHTML = "";
        const headerRow = dTable.querySelector("thead tr");
        if (headerRow) {
          const clonedHeader = headerRow.cloneNode(true);
          popupTable.appendChild(clonedHeader);
        }
        let found = false;
        dRows.forEach(dRow => {
          const dCells = dRow.querySelectorAll("td");
          if (dCells[1] && dCells[1].innerText.trim() === orderNumber) {
            const clonedRow = dRow.cloneNode(true);
            popupTable.appendChild(clonedRow);
            found = true;
          }
        });
        if (found) {
          popupModal.style.display = "block";
        } else {
          alert("No matching detail found for Order Number: " + orderNumber);
        }
      }
    });
  }
});
</script></body>
</html>
