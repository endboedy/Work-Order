<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Aplikasi Monitoring</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .tabs { display: flex; margin-bottom: 20px; }
    .tab { padding: 10px 20px; border: 1px solid #ccc; cursor: pointer; }
    .tab.active { background: #007bff; color: white; }
    .content { display: none; }
    .content.active { display: block; }
    .box { margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; }
    progress { width: 100%; }
  </style>
</head>
<body>
  <h2>üìä Aplikasi Monitoring</h2>

  <!-- MENU -->
  <div class="tabs">
    <div class="tab active" onclick="openTab(1)">1. Upload File</div>
    <div class="tab" onclick="openTab(2)">2. Perhitungan</div>
    <div class="tab" onclick="openTab(3)">3. Data Repo</div>
    <div class="tab" onclick="openTab(4)">4. About</div>
  </div>

  <!-- MENU 1 -->
  <div id="tab1" class="content active">
    <h3>üìÇ Upload File Excel</h3>
    <div class="box">
      <label> IW39: <input type="file" id="file-IW39"> </label>
      <button onclick="uploadFile('IW39')">Upload</button>
      <progress id="progress-IW39" value="0" max="100"></progress>
      <div id="status-IW39"></div>
    </div>
    <div class="box">
      <label> SUM57: <input type="file" id="file-SUM57"> </label>
      <button onclick="uploadFile('SUM57')">Upload</button>
      <progress id="progress-SUM57" value="0" max="100"></progress>
      <div id="status-SUM57"></div>
    </div>
    <div class="box">
      <label> DET: <input type="file" id="file-DET"> </label>
      <button onclick="uploadFile('DET')">Upload</button>
      <progress id="progress-DET" value="0" max="100"></progress>
      <div id="status-DET"></div>
    </div>
    <div class="box">
      <label> External Job: <input type="file" id="file-ExternalJob"> </label>
      <button onclick="uploadFile('ExternalJob')">Upload</button>
      <progress id="progress-ExternalJob" value="0" max="100"></progress>
      <div id="status-ExternalJob"></div>
    </div>
    <div class="box">
      <label> Planning: <input type="file" id="file-Planning"> </label>
      <button onclick="uploadFile('Planning')">Upload</button>
      <progress id="progress-Planning" value="0" max="100"></progress>
      <div id="status-Planning"></div>
    </div>
    <div class="box">
      <label> Equipt Adm: <input type="file" id="file-EquiptAdm"> </label>
      <button onclick="uploadFile('EquiptAdm')">Upload</button>
      <progress id="progress-EquiptAdm" value="0" max="100"></progress>
      <div id="status-EquiptAdm"></div>
    </div>
    <div class="box">
      <label> Data1: <input type="file" id="file-Data1"> </label>
      <button onclick="uploadFile('Data1')">Upload</button>
      <progress id="progress-Data1" value="0" max="100"></progress>
      <div id="status-Data1"></div>
    </div>
    <div class="box">
      <label> Data2: <input type="file" id="file-Data2"> </label>
      <button onclick="uploadFile('Data2')">Upload</button>
      <progress id="progress-Data2" value="0" max="100"></progress>
      <div id="status-Data2"></div>
    </div>
  </div>

  <!-- MENU 2 -->
  <div id="tab2" class="content">
    <h3>üìà Perhitungan Plan vs Actual</h3>
    <div class="box">
      <button onclick="hitung()">Hitung</button>
      <div id="hasilHitung"></div>
    </div>
  </div>

  <!-- MENU 3 -->
  <div id="tab3" class="content">
    <h3>üìÅ File di Repo</h3>
    <button onclick="listFiles()">Refresh List</button>
    <ul id="fileList"></ul>
  </div>

  <!-- MENU 4 -->
  <div id="tab4" class="content">
    <h3>‚Ñπ About</h3>
    <p>Aplikasi monitoring berbasis GitHub Pages</p>
  </div>

  <script>
    /* === Fungsi Tab === */
    function openTab(n) {
      document.querySelectorAll('.tab').forEach((el,i)=>el.classList.toggle('active', i===n-1));
      document.querySelectorAll('.content').forEach((el,i)=>el.classList.toggle('active', i===n-1));
    }

    /* === Upload file ke GitHub === */
    async function uploadFile(targetName) {
      const input = document.getElementById(file-${targetName});
      const status = document.getElementById(status-${targetName});
      const progress = document.getElementById(progress-${targetName});

      if (!input.files.length) {
        status.textContent = "‚ö† Pilih file dulu!";
        return;
      }

      const file = input.files[0];
      const content = await file.arrayBuffer();
      const base64 = btoa(String.fromCharCode(...new Uint8Array(content)));

      status.textContent = "‚è≥ Uploading...";
      progress.value = 50;

      try {
        const repo = "USERNAME/REPO"; // ganti dengan repo kamu
        const path = data/${file.name};
        const url = https://api.github.com/repos/${repo}/contents/${path};

        const res = await fetch(url, {
          method: "PUT",
          headers: {
            "Authorization": token __GH_TOKEN__,  // diganti otomatis via YAML
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: Upload ${file.name},
            content: base64
          })
        });

        if (res.ok) {
          status.textContent = "‚úÖ Sukses upload!";
          progress.value = 100;
        } else {
          status.textContent = "‚ùå Gagal upload!";
          console.error(await res.text());
        }
      } catch (err) {
        status.textContent = "‚ö† Error!";
        console.error(err);
      }
    }

    /* === List file di repo === */
    async function listFiles() {
      const fileList = document.getElementById("fileList");
      fileList.innerHTML = "‚è≥ Loading...";
      try {
        const repo = "USERNAME/REPO"; // ganti
        const url = https://api.github.com/repos/${repo}/contents/data;
        const res = await fetch(url, {
          headers: { "Authorization": token __GH_TOKEN__ }
        });
        if (!res.ok) throw new Error("Gagal ambil list file");
        const data = await res.json();
        fileList.innerHTML = "";
        data.forEach(f => {
          const li = document.createElement("li");
          li.textContent = f.name;
          fileList.appendChild(li);
        });
      } catch (err) {
        fileList.innerHTML = "‚ö† Error ambil data";
        console.error(err);
      }
    }

    /* === Hitung Plan vs Actual (dummy perhitungan) === */
    async function hitung() {
      const hasil = document.getElementById("hasilHitung");
      // ‚ö† nanti bisa diubah ke fetch file Excel & parsing
      const totalPlan = 20000;
      const totalActual = 15000;
      const rumus = (totalPlan - totalActual) / 16500;
      hasil.textContent = Hasil = ${(rumus*100).toFixed(2)} %;
    }
  </script>
</body>
</html>
