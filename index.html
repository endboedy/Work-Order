
<!DOCTYPE html>
<html>
<head>
    <title>WORK_ORDER_EM</title>
    <script src="https://cdnjs.cloudflare.com/ajax18.5/xlsx.full.min.js
    <style>
        body { font-family: Arial; font-size: 11px; }
        .filter-container { margin-bottom: 20px; padding: 10px; background-color: #f0f0f0; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 4px; cursor: pointer; }
        th { background-color: #eee; }
    </style>
</head>
<body>
    <h2>WORK_ORDER_EM</h2>
    <div class="filter-container">
        <label>Room: <input type="text" id="filter-room"></label>
        <label>Order: <input type="text" id="filter-order"></label>
        <label>MAT: <input type="text" id="filter-mat"></label>
        <label>Section: <input type="text" id="filter-section"></label>
        <label>CPH: <input type="text" id="filter-cph"></label>
        <label>Status: <input type="text" id="filter-status"></label>
        <br><br>
        <input type="file" id="upload" accept=".xlsx" />
    </div>
    <table id="wo-table">
        <thead></thead>
        <tbody></tbody>
    </table>

    <script>
        let originalData = [];
        let headers = [];

        function formatDate(excelDate) {
            if (!excelDate) return "";
            const date = new Date(Math.round((excelDate - 25569) * 86400 * 1000));
            const options = { day: '2-digit', month: 'short', year: 'numeric' };
            return date.toLocaleDateString('en-US', options).replace(/ /g, '-');
        }

        function formatCurrency(value) {
            if (!value) return "";
            return "$" + parseInt(value).toLocaleString();
        }

        function applyStyle(col, val) {
            let style = "";
            let align = "left";
            if (["Order", "Created On", "Planning", "Target Date", "End Date", "Cost", "Include", "Exclude"].includes(col)) {
                align = "right";
            } else if (["User Status", "MAT"].includes(col)) {
                align = "center";
            }

            if (col === "Status Part") {
                if (val === "Complete") style = "background-color:green;color:white";
                else if (val === "Not Complete") style = "background-color:red;color:white";
            } else if (col === "Aging") {
                const aging = parseInt(val);
                if (!isNaN(aging)) {
                    if (aging <= 30) style = "background-color:green;color:white";
                    else style = "background-color:red;color:white";
                }
            } else if (col === "Status AMT") {
                if (val === "") style = "background-color:white;color:black";
                else if (val === "O") style = "background-color:lightgray;color:black";
                else if (val === "YTS") style = "background-color:green;color:white";
                else if (val === "IP") style = "background-color:orange;color:red";
                else if (val === "C") style = "background-color:black;color:white";
            }

            return `style="text-align:${align};${style}"`;
        }

        function renderTable(data) {
            const thead = document.querySelector("#wo-table thead");
            const tbody = document.querySelector("#wo-table tbody");

            thead.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
            tbody.innerHTML = "";

            data.forEach(row => {
                const tr = document.createElement("tr");
                headers.forEach((col, i) => {
                    let val = row[i] || "";
                    if (["Created On", "Planning", "Target Date", "End Date"].includes(col)) {
                        val = formatDate(val);
                    } else if (["Cost", "Include", "Exclude"].includes(col)) {
                        val = formatCurrency(val);
                    }
                    const td = document.createElement("td");
                    td.innerHTML = val;
                    td.setAttribute("style", applyStyle(col, val).replace('style="', '').replace('"', ''));
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        function filterData() {
            const room = document.getElementById("filter-room").value.toLowerCase();
            const order = document.getElementById("filter-order").value.toLowerCase();
            const mat = document.getElementById("filter-mat").value.toLowerCase();
            const section = document.getElementById("filter-section").value.toLowerCase();
            const cph = document.getElementById("filter-cph").value.toLowerCase();
            const status = document.getElementById("filter-status").value.toLowerCase();

            const filtered = originalData.filter(row => {
                const rowObj = Object.fromEntries(headers.map((h, i) => [h, row[i] ? row[i].toString().toLowerCase() : ""]));
                return (
                    rowObj["Room"].includes(room) &&
                    rowObj["Order"].includes(order) &&
                    rowObj["MAT"].includes(mat) &&
                    rowObj["Section"].includes(section) &&
                    rowObj["CPH"].includes(cph) &&
                    rowObj["User Status"].includes(status)
                );
            });

            renderTable(filtered);
        }

        document.querySelectorAll(".filter-container input").forEach(input => {
            input.addEventListener("input", filterData);
        });

        document.getElementById('upload').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(sheet, {header:1});
                headers = json[0];
                originalData = json.slice(1);
                renderTable(originalData);
            };
            reader.readAsArrayBuffer(e.target.files[0]);
        });

        document.querySelector("#wo-table thead").addEventListener("click", function(e) {
            if (e.target.tagName === "TH") {
                const index = Array.from(e.target.parentNode.children).indexOf(e.target);
                const asc = !e.target.asc;
                e.target.asc = asc;
                originalData.sort((a, b) => {
                    const valA = a[index] ? a[index].toString() : "";
                    const valB = b[index] ? b[index].toString() : "";
                    return asc ? valA.localeCompare(valB) : valB.localeCompare(valA);
                });
                renderTable(originalData);
            }
        });
    </script>
</body>
</html>
