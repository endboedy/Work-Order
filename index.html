<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Order EM</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .tabs { display: flex; border-bottom: 2px solid #ccc; margin-bottom: 20px; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; border-bottom: none; background: #f1f1f1; }
    .tab.active { background: #fff; font-weight: bold; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .upload-section { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
    .progress-bar { width: 100%; background: #eee; height: 20px; margin-top: 5px; }
    .progress { height: 100%; width: 0; background: green; }
    .status { margin-top: 5px; font-size: 12px; }
  </style>
</head>
<body>

  <h2>📊 Work Order EM</h2>

  <!-- Menu Tabs -->
  <div class="tabs">
    <div class="tab active" onclick="openTab(0)">Menu 1 - Upload</div>
    <div class="tab" onclick="openTab(1)">Menu 2 - Data</div>
    <div class="tab" onclick="openTab(2)">Menu 3 - Grafik</div>
    <div class="tab" onclick="openTab(3)">Menu 4 - Summary</div>
  </div>

  <!-- Menu 1 -->
  <div class="tab-content active">
    <h3>📤 Upload Excel Files</h3>
    <p>Pilih file lalu klik upload. File akan disimpan ke repo <code>/data/</code>.</p>
    
    <div id="upload-list"></div>
  </div>

  <!-- Menu 2 -->
  <div class="tab-content">
    <h3>📑 Data Processing</h3>
    <p>Di sini tabel hasil gabungan lookup dari IW39, SUM57, dll akan muncul.</p>
    <div id="table-container"></div>
  </div>

  <!-- Menu 3 -->
  <div class="tab-content">
    <h3>📈 Grafik</h3>
    <canvas id="chart"></canvas>
  </div>

  <!-- Menu 4 -->
  <div class="tab-content">
    <h3>📋 Summary</h3>
    <div id="summary"></div>
  </div>

<script>
/* ========== TAB CONTROL ========== */
function openTab(i) {
  document.querySelectorAll('.tab').forEach((t, idx) => {
    t.classList.toggle('active', i === idx);
  });
  document.querySelectorAll('.tab-content').forEach((c, idx) => {
    c.classList.toggle('active', i === idx);
  });
}

/* ========== MENU 1: UPLOAD ========== */
const files = [
  "IW39.xlsx",
  "SUM57.xlsx",
  "DET.xlsx",
  "External Job.xlsx",
  "Planning.xlsx",
  "Equipt Adm.xlsx",
  "Data1.xlsx",
  "Data2.xlsx"
];

const uploadList = document.getElementById('upload-list');
uploadList.innerHTML = files.map(file => `
  <div class="upload-section">
    <label>${file}:</label><br>
    <input type="file" id="file-${file}" /><br>
    <button onclick="uploadFile('${file}')">Upload</button>
    <div class="progress-bar"><div id="progress-${file}" class="progress"></div></div>
    <div id="status-${file}" class="status"></div>
  </div>
`).join("");

// 🔑 Ganti ini dengan token kamu via Secrets, jangan hardcode!
const GH_REPO = "endboedy/Work_Order_EM";
const BRANCH = "main";
const TOKEN = "{GH_TOKEN}";

/* Upload file ke GitHub */
async function uploadFile(targetName) {
  const input = document.getElementById(file-${targetName});
const status = document.getElementById(status-${targetName});
const progress = document.getElementById(progress-${targetName});
  if (!input.files.length) {
    status.textContent = "⚠ Pilih file dulu!";
    return;
  }
  
  const file = input.files[0];
  const reader = new FileReader();
  reader.onload = async function(e) {
    const content = e.target.result.split(",")[1]; // ambil base64
    status.textContent = "⏳ Uploading...";
    progress.style.width = "50%";
    
    try {
      const url = https://api.github.com/repos/${GH_REPO}/contents/data/${targetName};
      const res = await fetch(url, {
        method: "PUT",
        headers: {
          "Authorization": token ${TOKEN},
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: update ${targetName},
          content: content,
          branch: BRANCH
        })
      });
      if (res.ok) {
        status.textContent = "✅ Upload sukses";
        progress.style.width = "100%";
      } else {
        const err = await res.json();
        status.textContent = "❌ Gagal: " + (err.message || "Error");
        progress.style.width = "0";
      }
    } catch (e) {
      status.textContent = "❌ Error: " + e.message;
      progress.style.width = "0";
    }
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
